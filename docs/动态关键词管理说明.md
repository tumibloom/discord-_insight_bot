# 动态关键词管理功能说明

## 📋 功能概述

这个功能允许您无需停止机器人就能动态管理触发关键词，支持正则表达式模式，让机器人能够识别更复杂的用户消息。

## 🎯 主要特性

### ✨ 动态管理
- **无需重启**：添加、删除、修改关键词无需停止机器人
- **实时生效**：关键词修改立即生效
- **权限控制**：需要相应权限才能管理关键词

### 🔧 正则表达式支持
- 支持完整的正则表达式语法
- 忽略大小写匹配
- Unicode字符支持
- 模式验证确保语法正确

### 📊 统计功能
- 触发次数统计
- 创建时间记录
- 启用/禁用状态追踪

## 🛠️ Discord命令

### `/keyword-add` - 添加关键词
```
/keyword-add pattern:"chatgpt.*error" description:"ChatGPT错误问题"
```
- **权限要求**：管理消息权限
- **pattern**：正则表达式模式（必填）
- **description**：关键词描述（可选）

### `/keyword-remove` - 删除关键词
```
/keyword-remove pattern:"chatgpt.*error"
```
- **权限要求**：管理消息权限
- **pattern**：要删除的正则表达式模式

### `/keyword-toggle` - 切换启用状态
```
/keyword-toggle pattern:"chatgpt.*error"
```
- **权限要求**：管理消息权限
- 在启用和禁用之间切换

### `/keyword-list` - 查看所有关键词
```
/keyword-list
```
- 显示所有关键词（包括禁用的）
- 支持分页显示
- 显示触发统计和创建时间

### `/keyword-reload` - 重新加载关键词
```
/keyword-reload
```
- **权限要求**：管理员权限
- 手动重新加载所有关键词
- 通常不需要使用，系统会自动同步

## 📝 正则表达式示例

### 基础匹配
```regex
sillytavern          # 匹配 "sillytavern"
api.*error           # 匹配 "api error", "api connection error" 等
\bst\b              # 只匹配独立的 "st" 单词
```

### 中文匹配
```regex
api.*错误            # 匹配 "api错误", "api连接错误" 等
(配置|设置).*问题      # 匹配 "配置问题", "设置问题" 等
角色卡.*导入          # 匹配角色卡相关导入问题
```

### 复杂模式
```regex
(openai|claude|gemini).*(api|连接|错误)  # 匹配多种AI服务的问题
chatgpt.*(429|limit|quota)             # 匹配ChatGPT配额限制问题
stable\s*diffusion.*生成.*失败          # 匹配Stable Diffusion生成失败
```

## ⚠️ 使用注意事项

### 正则表达式安全
- 避免过于复杂的正则表达式，可能影响性能
- 测试正则表达式确保匹配预期内容
- 避免过于宽泛的匹配模式

### 权限管理
- 只有具有"管理消息"权限的用户才能管理关键词
- 重新加载功能需要管理员权限
- 建议限制关键词管理人员数量

### 性能考虑
- 关键词数量建议控制在合理范围内（<100个）
- 复杂的正则表达式会增加匹配时间
- 系统会自动编译正则表达式以提高性能

## 🔍 调试和监控

### 触发统计
- 每个关键词都有触发次数统计
- 可以通过统计了解哪些关键词最常用
- 无用的关键词可以及时删除

### 日志记录
- 关键词触发会在日志中记录
- 管理操作也会记录到日志
- 可以通过日志追踪问题

## 📚 最佳实践

### 关键词设计
1. **具体性**：关键词要足够具体，避免误触发
2. **覆盖性**：考虑用户可能的不同表达方式
3. **维护性**：定期检查和清理无用关键词

### 管理流程
1. **测试**：新关键词添加后在测试频道验证
2. **监控**：观察触发频率和效果
3. **优化**：根据统计数据调整关键词

### 示例关键词集
```
# SillyTavern核心问题
sillytavern.*错误
sillytavern.*无法启动
sillytavern.*连接失败

# API相关问题
api.*key.*invalid
api.*401|403|429|500
(openai|claude|gemini).*配额

# 角色卡问题
角色卡.*导入.*失败
character.*card.*error
json.*格式.*错误

# 配置问题
(配置|config).*错误
settings.*问题
参数.*设置.*问题
```

## 🔧 故障排除

### 关键词不触发
1. 检查关键词是否启用
2. 验证正则表达式语法
3. 使用 `/keyword reload` 重新加载

### 误触发过多
1. 优化正则表达式使其更具体
2. 添加排除模式
3. 临时禁用有问题的关键词

### 性能问题
1. 检查关键词数量
2. 优化复杂的正则表达式
3. 删除无用的关键词
